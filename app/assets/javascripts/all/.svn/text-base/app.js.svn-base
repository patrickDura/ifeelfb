/******************************
* Patrick Dura
* dura.fr
* Creation : 21/02/2012
* Update : 21/02/2012
*******************************/

/// Depends on :
///   Jquery 1.7.1

// Namespace
var App = {
    version:"1.0.0"
};

// Init Space
App.components={};

// Init when dom ready
$(document).ready(function() {
	
    if($("#locateme"))
    {
        $("#locateme").click(function() {
          App.Geo.GetLocation();
      })
    }

    try{
        App.InitMap();    
    }
    catch(err)
    {

    }
    
    try{
        App.InitSmallMap();
    }
    catch(err)
    {
        
    }

    try{
        
        // set effect from select menu value
        // $( "#topicsmap" ).click(function() {
        //     $( "#topicsmap" ).toggle( "slide", {}, 500 );
        //     return false;
        // });

        $( "#toolbox" ).change(function() {
            $( "#topicsmap" ).toggle( "slide", {}, 500 );
            return false;
        });
        
    }
    catch(err)
    {
        
    }

    var now = new Date();
    var until = new Date(2012,05, 02, 12,0,0);

    var difference = until - now;

    var daysDifference = Math.floor(difference/1000/60/60/24);
    difference -= daysDifference*1000*60*60*24

    var hoursDifference = Math.floor(difference/1000/60/60);
    difference -= hoursDifference*1000*60*60

    var minutesDifference = Math.floor(difference/1000/60);
    difference -= minutesDifference*1000*60
    
    var secondesDifference = parseInt(difference / 1000); 

    hoursDifference += daysDifference*24;

    // console.log(hoursDifference);
    // console.log(minutesDifference);
    // console.log(secondesDifference);

    if(hoursDifference <= 99)
    {
        hoursDifference = 0 + hoursDifference.toString();
    }

    if(minutesDifference <= 9)
    {
        minutesDifference = 0 + minutesDifference.toString();
    }

    if(secondesDifference <= 9)
    {
        secondesDifference = 0 + secondesDifference.toString();
    }

    $('#counter').countdown({
        stepTime: 60,
        format: 'hhh:mm:ss',
        startTime: hoursDifference + ":" + minutesDifference + ":" + secondesDifference,
        //startTime: '102:00:00',
        digitImages: 6,
        digitWidth: 53,
        digitHeight: 77,
        timerEnd: function() { alert('end!!'); },
        image: "../assets/digits.png"
    });
 
    try{
        $('#counteronly').countdown({
        stepTime: 60,
        format: 'hhh:mm:ss',
        //startTime: hoursDifference + ":" + minutesDifference + ":" + secondesDifference,
        startTime: '102:00:00',
        digitImages: 6,
        digitWidth: 53,
        digitHeight: 77,
        timerEnd: function() { alert('end!!'); },
        image: "../assets/digits.png"
         });
    }
    catch(err)
    {
        
    }

    try{
        $('#counteronlytime').countdown({
        stepTime: 60,
        format: 'hhh:mm:ss',
        startTime: hoursDifference + ":" + minutesDifference + ":" + secondesDifference,
        digitImages: 6,
        digitWidth: 53,
        digitHeight: 77,
        timerEnd: function() { alert('end!!'); },
        image: "../assets/digits.png"
         });
    }
    catch(err)
    {
        
    }

    // Configuration du datepicker
    $.timepicker.setDefaults($.timepicker.regional['fr']);
    $('.datepicker').datetimepicker({
        minDate: new Date(),
        separator: ' @ ',
        dateFormat : "dd/mm/yy"
    });


//	var markers = []
//	var infowindow = new google.maps.InfoWindow();

	// windowListener = function getInfoWindowEvent(marker) {
	// 	infowindow.close()
	// 	infowindow.setContent(marker.html);
	// 	infowindow.open(map, marker);
	// }


	// Display Data
//	App.DisplayData(map);

	// Temps restant avant minuit
//	var today=new Date()
//	var until=new Date(2012, 05, 14, 17, 00, 00) //Month is 0-11 in JavaScript
//	
//	//Set 1 day in milliseconds	
//
//	//Calculate difference btw the two dates, and convert to days
//	var diff = (until.getTime()-today.getTime());
//	var hour = diff.getHours();
//	
//	console.log(hour);
//	
//	console.log(diff);

});

App.InitMap = function(){
	
	 // Define the map to use from MapBox
    // This is the TileJSON endpoint copied from the embed button on your map
    var url = 'http://a.tiles.mapbox.com/v3/102heures.map-o3gyd0hw.jsonp';

    // Make a new Leaflet map in your container div
    var map = new L.Map('map') 

    // Center the map on Washington, DC, at zoom 15
    .setView(new L.LatLng(47.215, -1.5515), 13);
    
    // Get metadata about the map from MapBox
    wax.tilejson(url, function(tilejson) {
        map.addLayer(new wax.leaf.connector(tilejson));
    });

    var id = $('#key').text()

    $.ajax({
    	url: '/api/v1/topic/' + id
    }).done(function(data) { 
    	App.displayTopic(data[0], map);
    });

}

App.InitSmallMap = function(){
    
     // Define the map to use from MapBox
    // This is the TileJSON endpoint copied from the embed button on your map
    var url = 'http://a.tiles.mapbox.com/v3/102heures.map-1z8oc6t0.jsonp';

    // Make a new Leaflet map in your container div
    var map = new L.Map('smallmap') 

    // Center the map on Washington, DC, at zoom 15
    .setView(new L.LatLng(47.215, -1.5515), 13);
    
    // Get metadata about the map from MapBox
    wax.tilejson(url, function(tilejson) {
        map.addLayer(new wax.leaf.connector(tilejson));
    });

    var id = $('#key').text()

    $.ajax({
        url: '/api/v1/topic/' + id
    }).done(function(data) { 
        App.displayTopic(data[0], map);
    });

}

App.displayTopic = function(data, map){
  var museumIcon = L.Icon.extend({
    iconUrl: "/assets/pins/pin-blue-twitter.png",
    shadowUrl: "",
    iconSize: new L.Point(44, 55),
    shadowSize: null,
    iconAnchor: new L.Point(22, 22),
    popupAnchor: new L.Point(0,-24)
});

    // Define a geojson data layer
    var geojsonLayer = new L.GeoJSON(data, {
      pointToLayer: function (latlng) {
        return new L.Marker(latlng, {
          icon: new museumIcon()
      });
    }
});

    // Display the name property on click
    geojsonLayer.on('featureparse', function (e) {
        if (e.properties && e.properties.name){
            e.layer.bindPopup(e.properties.name);
        }
    });

    // Populate our geojson layer with data
    geojsonLayer.addGeoJSON(data);
    
    // Add the GeoJSON layer
    map.addLayer(geojsonLayer);
}

    // var museumIcon = L.Icon.extend({
    //     iconUrl: "/bundles/app/js/images/pin-blue-transparent.png",
    //     shadowUrl: null,
    //     iconSize: new L.Point(44, 55),
    //     shadowSize: null,
    //     iconAnchor: new L.Point(12, 24),
    //     popupAnchor: new L.Point(0,-24)
    // });

    // // Define a geojson data layer
    // var geojsonLayer = new L.GeoJSON(data, {
    //   pointToLayer: function (latlng) {
    //     return new L.Marker(latlng, {
    //       icon: new museumIcon()
    //     });
    //   }
    // });

    // // Display the name property on click
    // geojsonLayer.on('featureparse', function (e) {
    //     if (e.properties && e.properties.name){
    //         e.layer.bindPopup(e.properties.name);
    //     }
    // });

    // // Populate our geojson layer with data
    // geojsonLayer.addGeoJSON(data);

    // // Add the GeoJSON layer
    // map.addLayer(geojsonLayer);


// 	var element = document.getElementById("");

// 	var nantes = new google.maps.LatLng(47.215, -1.5515);

//     var map = new google.maps.Map(element, {
//     	zoom : 12,
// 		center : nantes,
//         mapTypeId: "OSM",
//         mapTypeControlOptions: {
//             mapTypeIds: ["OSM"]
//         }
//     });

//     map.mapTypes.set("OSM", new google.maps.ImageMapType({
//         getTileUrl: function(coord, zoom) {
//             return "http://tile.openstreetmap.org/" + zoom + "/" + coord.x + "/" + coord.y + ".png";
//         },
//         tileSize: new google.maps.Size(256, 256),
//         name: "OpenStreetMap",
//         maxZoom: 18
//     }));

//     return map;

// App.InitMiniMap = function(){
// 	var element = document.getElementById("mini_map");

// 	var nantes = new google.maps.LatLng(47.215, -1.5515);

//     var map = new google.maps.Map(element, {
//     	zoom : 12,
// 		center : nantes,
//         mapTypeId: "OSM",
//         mapTypeControlOptions: {
//             mapTypeIds: ["OSM"]
//         }
//     });

//     map.mapTypes.set("OSM", new google.maps.ImageMapType({
//         getTileUrl: function(coord, zoom) {
//             return "http://tile.openstreetmap.org/" + zoom + "/" + coord.x + "/" + coord.y + ".png";
//         },
//         tileSize: new google.maps.Size(256, 256),
//         name: "OpenStreetMap",
//         maxZoom: 18
//     }));

//     return map;
// }


// App.DisplayData = function(){
	
// 	var image1 = 'logoCam.png';
// 	var image2 = "logoLiv.png";
// 	var image3 = "logoSon.png";
// 	var image4 = "logoTwit.png";
// 	var image5 = "logotxt.png";
// 	var image6 = "logoVid.png";
// 	var image7 = "logoViz.png";

// 	var color = 'j';

// 	var url = "/web/bundles/app/images/map/" + color + "/" + image4;
// 	var lat1 = '47.215';
// 	var lng1 = '-1.5515';
// 	var infoHTML = '<h3> Mon premier tweet</h3>';

// 	App.MakePin(lat1, lng1, infoHTML, url);

// 	var url = "/web/bundles/app/images/map/" + color + "/" + image2;
// 	var lat2 = '47.224';
// 	var lng2 = '-1.5845';
// 	var infoHTML = '<h3> Ma première photo</h3><img src="/web/bundles/app/images/illustration/eau.jpg"/>';

// 	App.MakePin(lat2, lng2, infoHTML, url);

// 	var url = "/web/bundles/app/images/map/" + color + "/" + image1;
// 	var lat3 = '47.246';
// 	var lng3 = '-1.5345';
// 	var infoHTML = '<h3> Ma première video</h3><iframe src="http://player.vimeo.com/video/13122096" width="700" height="390" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';

// 	App.MakePin(lat3, lng3, infoHTML, url);


// 	var url = "/web/bundles/app/images/map/" + color + "/" + image3;
// 	var lat4 = '47.246';
// 	var lng4 = '-1.5745';
// 	var infoHTML = '<h3>Interview</h3><iframe width="100%" height="166" scrolling="no" frameborder="no" src="http://w.soundcloud.com/player/?url=http%3A%2F%2Fapi.soundcloud.com%2Ftracks%2F46146506&show_artwork=true"></iframe>';

// 	App.MakePin(lat4, lng4, infoHTML, url);

// 	var url = "/web/bundles/app/images/map/" + color + "/" + image7;
// 	var lat5 = '47.196';
// 	var lng5 = '-1.6895';
// 	var infoHTML = '<h3>Interview</h3>';

// 	App.MakePin(lat5, lng5, infoHTML, url);

// 	var flightPlanCoordinates = [
// 	                             new google.maps.LatLng(lat1, lng1),
// 	                             new google.maps.LatLng(lat2, lng2),
// 	                             new google.maps.LatLng(lat3, lng3),
// 	                             new google.maps.LatLng(lat4, lng4),
// 	                             new google.maps.LatLng(lat5, lng5)
// 	                           ];
// 	                           var flightPath = new google.maps.Polyline({
// 	                             path: flightPlanCoordinates,
// 	                             strokeColor: "#fcff02",
// 	                             strokeOpacity: 1.0,
// 	                             strokeWeight: 2
// 	                           });

// 	                           flightPath.setMap(map);

// 	var color = 'r';

// 	var url = "/web/bundles/app/images/map/" + color + "/" + image4;
// 	var lat1 = '47.285';
// 	var lng1 = '-1.5515';
// 	var infoHTML = '<h3> Mon premier tweet</h3>';

// 	App.MakePin(lat1, lng1, infoHTML, url);

// 	var url = "/web/bundles/app/images/map/" + color + "/" + image2;
// 	var lat2 = '47.294';
// 	var lng2 = '-1.5245';
// 	var infoHTML = '<h3> Ma première photo</h3><img src="/web/bundles/app/images/illustration/eau.jpg"/>';

// 	App.MakePin(lat2, lng2, infoHTML, url);

// 	var url = "/web/bundles/app/images/map/" + color + "/" + image1;
// 	var lat3 = '47.296';
// 	var lng3 = '-1.6345';
// 	var infoHTML = '<h3> Ma première video</h3><iframe src="http://player.vimeo.com/video/13122096" width="700" height="390" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>';

// 	App.MakePin(lat3, lng3, infoHTML, url);


// 	var url = "/web/bundles/app/images/map/" + color + "/" + image3;
// 	var lat4 = '47.346';
// 	var lng4 = '-1.5795';
// 	var infoHTML = '<h3>Interview</h3><iframe width="100%" height="166" scrolling="no" frameborder="no" src="http://w.soundcloud.com/player/?url=http%3A%2F%2Fapi.soundcloud.com%2Ftracks%2F46146506&amp;auto_play=false&amp;show_artwork=false&amp;color=ff7700"></iframe>';

// 	App.MakePin(lat4, lng4, infoHTML, url);

// 	var url = "/web/bundles/app/images/map/" + color + "/" + image7;
// 	var lat5 = '47.396';
// 	var lng5 = '-1.6745';
// 	var infoHTML = '<h3>Interview</h3>';

// 	App.MakePin(lat5, lng5, infoHTML, url);

// 	var flightPlanCoordinates = [
// 	                             new google.maps.LatLng(lat1, lng1),
// 	                             new google.maps.LatLng(lat2, lng2),
// 	                             new google.maps.LatLng(lat3, lng3),
// 	                             new google.maps.LatLng(lat4, lng4),
// 	                             new google.maps.LatLng(lat5, lng5)
// 	                           ];
// 	                           var flightPath = new google.maps.Polyline({
// 	                             path: flightPlanCoordinates,
// 	                             strokeColor: "#FF0000",
// 	                             strokeOpacity: 1.0,
// 	                             strokeWeight: 2
// 	                           });

// 	                           flightPath.setMap(map);
// };

// App.MakePin = function(lat, lng, infoHTML, url)
// {
// 	var pinImage = new google.maps.MarkerImage(url,
// 			new google.maps.Size(70, 70),
// 			new google.maps.Point(0,0),
// 			new google.maps.Point(10, 34));		

// 			var pos = new google.maps.LatLng(lat, lng);

// 			var marker = new google.maps.Marker({
// 				position : pos,
// 				map : map,
// 				title : "titre",
// 				icon: pinImage,
// 				html : infoHTML
// 			});

// 			google.maps.event.addListener(marker, 'click', function() {
// 				windowListener(marker);
// 			});

// 			var pinImage = new google.maps.MarkerImage(url,
// 					new google.maps.Size(70, 70),
// 					new google.maps.Point(0,0),
// 					new google.maps.Point(10, 34));		

// 					var pos = new google.maps.LatLng(lat, lng);

// 					var marker = new google.maps.Marker({
// 						position : pos,
// 						map : map,
// 						title : "titre",
// 						icon: pinImage,
// 						html : infoHTML
// 					});

// 					google.maps.event.addListener(marker, 'click', function() {
// 						windowListener(marker);
// 					});
// }

